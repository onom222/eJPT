痕跡の削除
windowsにある痕跡の削除
・脆弱性攻撃フェーズおよびエクスプロイトフェーズでは、ターゲットシステムやその上に保存されたデータに積極的にアクセスする必要がある
・その結果、ルール・オブ・エンゲージメントに基づき、侵害したターゲットシステムに対して行った変更を消去したり元に戻したりする必要がある
・ターゲットシステムにファイルを転送した場合、それらがどこに保存されたかを把握しておき、作業終了後に削除できるようにしておく
・習慣として、すべてのスクリプト、エクスプロイト、バイナリはWindowsでじゃ、C:\Tempディレクトリ、linuxでは、/temディレクトリに保存しておくと管理しやすく、後で削除しやすい

・使用しているエクスプロイトフレームワークについても考慮することが重要
例えば、msfは、エクスプロイトモジュールやポストモジュールを使用する際、ターゲットシステム上に多くのアーティファクトを生成、保存することで有名
・よく設計されたMSFモジュールの中には、アーティファクトがどこに保存されるか、またどうやって削除できるかについての情報を提供する指示やリソーススクリプトを備えているものがある
・Windowsの文脈では、痕跡消去に関連する典型的なポストエクスプロイト手法として、windows event logを削除することがある
しかし、windows event logはクライアントにとって重要なデータを多く保持しているため、ペンテスでは削除すべきではない

・demo Windowsでトラフィックを削除する
1) pingでターゲットホストが稼働しているかを確認する
2) nmap -sVでセキュリティホールを探索する。
3) 2)で見つけたセキュリティホールを突けるモジュールを起動するために、msfconsoleを起動する
service postgresql start && msfconsole
4) use exploit/windows/http/badblue_passthruを使ってモジュールを起動する
5) setで基本情報を設定する
6) exploitでmeterpreterの権限を奪う
7) windowsシステムにアクセスできたら、以下のコマンドを使ってwindows event log全体をクリアする
clearev

Linuxでの痕跡の削除
demo linuxでの痕跡削除
1) pingでホストが稼働しているかを確認する
2) nmap -sV -p port_numでターゲットホストのセキュリティホールを探索する
3) エクスプロイトを起動するために、以下のコマンドでmsfコンソールを起動する。
service postgresql start && msfconsole
4) useを使って、モジュールを起動する
5) set でオプションを設定する
6) exploitでmeterpreterの権限を奪う
7) /bin/bash -iで対話のコマンドに切り替える
8) linuxターゲットへのアクセスができたら、以下のコマンドでbashの履歴をクリアにできる
history -c
以下のコマンドのようにファイルを削除することにより、bashの履歴を消すことも可能
cat /dev/null > ~/.bash_history
